<%
# 카드 인덱스가 정의되지 않은 경우 0으로 기본값 설정
card_index = defined?(index) ? index : 0
%>

<!-- 기존 메인페이지용 카드 (모달 없는 심플 버전) -->
<div class="product-card">
    <div class="product-rank">#<%= (defined?(index) ? index + 1 : rand(1..100)) %></div>
    <div class="product-image">
        <% if product.logo_image.attached? %>
            <%= image_tag product.logo_thumb_1x, alt: product.name, style: "width: 100%; height: 100%; object-fit: cover;" %>
        <% else %>
            <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 2rem;">
                <%= product.name[0].upcase %>
            </div>
        <% end %>
    </div>
    <div class="product-content">
        <%= link_to product_path(product), class: "product-title-link" do %>
            <h3 class="product-title"><%= product.name %></h3>
            <p class="product-description"><%= product.tagline %></p>
        <% end %>
        <div class="product-meta">
            <% product.topics.each do |topic| %>
                <%= link_to topic.name, products_path(category: topic.slug), style: "text-decoration: none; color: inherit;" %>
            <% end %>
        </div>
    </div>
    <div class="product-stats">
        <% user_has_voted = product.voted_by?(current_user) %>
        <% user_has_commented = product.commented_by?(current_user) %>

        <% if current_user %>
            <button onclick="voteProduct(<%= product.id %>, <%= user_has_voted ? 'true' : 'false' %>)"
                    id="vote-btn-<%= product.id %>"
                    class="stat-button vote group"
                    data-voted="<%= user_has_voted %>"
                    style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.375rem; background: transparent; transition: all 0.3s; padding: 0.5rem; min-width: 56px; border: none; cursor: pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" style="width: 16px; height: 16px;" id="vote-icon-<%= product.id %>">
                    <path d="M8 3.5C8 3.5 8.5 3 9 3.8L11.5 8.5C12 9.3 11.8 10 11 10H5C4.2 10 4 9.3 4.5 8.5L7 3.8C7.5 3 8 3.5 8 3.5Z" stroke="<%= user_has_voted ? '#FF6154' : '#6B7280' %>" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="<%= user_has_voted ? '#FF6154' : 'none' %>"/>
                </svg>
                <span style="font-size: 15px; font-weight: 600; line-height: 1; color: <%= user_has_voted ? '#FF6154' : '#374151' %>; transition: opacity 0.2s ease;" id="vote-count-<%= product.id %>"><%= product.votes_count || 0 %></span>
            </button>
        <% else %>
            <a href="#" onclick="event.preventDefault(); if(confirm('투표하려면 로그인이 필요합니다. 로그인 페이지로 이동하시겠습니까?')) { window.location.href = '<%= login_path %>'; }" class="stat-button vote group" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.375rem; background: transparent; transition: all 0.3s; padding: 0.5rem; min-width: 56px; text-decoration: none; cursor: pointer;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" style="width: 16px; height: 16px;">
                    <path d="M8 3.5C8 3.5 8.5 3 9 3.8L11.5 8.5C12 9.3 11.8 10 11 10H5C4.2 10 4 9.3 4.5 8.5L7 3.8C7.5 3 8 3.5 8 3.5Z" stroke="#6B7280" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                </svg>
                <span style="font-size: 15px; font-weight: 600; line-height: 1; color: #374151;"><%= product.votes_count || 0 %></span>
            </a>
        <% end %>
        <%= link_to product_path(product, anchor: 'comments'), class: "stat-button group", style: "display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.375rem; background: transparent; transition: all 0.3s; padding: 0.5rem; min-width: 56px; text-decoration: none;" do %>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" style="width: 16px; height: 16px; stroke-width: 1.5px;">
                <path stroke="<%= user_has_commented ? '#FF6154' : '#6B7280' %>" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" fill="<%= user_has_commented ? '#FF6154' : 'none' %>" d="M14 7.667a5.667 5.667 0 0 1-7.703 5.287 2.286 2.286 0 0 0-.22-.078.571.571 0 0 0-.126-.016c-.06 0-.12.006-.2.014l-3.413.353c-.326.034-.488.05-.584-.008a.343.343 0 0 1-.157-.233c-.017-.111.06-.255.217-.543l1.09-2.018c.09-.167.135-.25.155-.329a.571.571 0 0 0 .018-.217c-.007-.083-.042-.19-.114-.403A5.667 5.667 0 1 1 14 7.667Z"></path>
            </svg>
            <span style="font-size: 15px; font-weight: 600; line-height: 1; color: <%= user_has_commented ? '#FF6154' : '#374151' %>;"><%= product.comments_count || 0 %></span>
        <% end %>
    </div>
</div>