<!-- 메인 콘텐츠 -->
<div class="main-container">
    <main>
        <!-- 이번주 신규 제품 섹션 -->
        <div class="homepage-section">
            <div class="section-header">
                <h2 class="section-title">이번주 신규 제품</h2>
                <%= link_to "더보기", '/challenges/weekly', class: "more-link" %>
            </div>
            <div class="product-list">
                <% cache ['this_week_new_products_v1', Date.current.beginning_of_week, current_user&.id] do %>
                    <% if @this_week_new_products.any? %>
                        <% @this_week_new_products.each_with_index do |product, index| %>
                            <%= render 'shared/product_card', product: product, index: index %>
                        <% end %>
                    <% else %>
                        <div class="empty-section">
                            <p>이번주 출시된 신규 제품이 없습니다.</p>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>

        <!-- 이번달 신규 제품 섹션 -->
        <div class="homepage-section">
            <div class="section-header">
                <h2 class="section-title">이번달 신규 제품</h2>
                <%= link_to "더보기", '/challenges/monthly', class: "more-link" %>
            </div>
            <div class="product-list">
                <% cache ['this_month_new_products_v1', Date.current.beginning_of_month, current_user&.id] do %>
                    <% if @this_month_new_products.any? %>
                        <% @this_month_new_products.each_with_index do |product, index| %>
                            <%= render 'shared/product_card', product: product, index: index %>
                        <% end %>
                    <% else %>
                        <div class="empty-section">
                            <p>이번달 출시된 제품이 없습니다.</p>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>

        <!-- 저번주 랭크보드 상위 섹션 -->
        <div class="homepage-section">
            <div class="section-header">
                <h2 class="section-title">저번주 랭크보드 상위</h2>
                <%= link_to "더보기", rankboard_weekly_path, class: "more-link" %>
            </div>
            <div class="product-list">
                <% cache ['last_week_top_products_v3', 1.week.ago.beginning_of_week.to_date, current_user&.id] do %>
                    <% if @last_week_top_products.any? %>
                        <% @last_week_top_products.each_with_index do |product, index| %>
                            <%= render 'shared/product_card', product: product, index: index %>
                        <% end %>
                    <% else %>
                        <div class="empty-section">
                            <p>저번주 출시된 제품이 없습니다.</p>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>

        <!-- 저번달 랭크보드 상위 섹션 -->
        <div class="homepage-section">
            <div class="section-header">
                <h2 class="section-title">저번달 랭크보드 상위</h2>
                <%= link_to "더보기", rankboard_monthly_path, class: "more-link" %>
            </div>
            <div class="product-list">
                <% cache ['last_month_top_products_v3', 1.month.ago.beginning_of_month.to_date, current_user&.id] do %>
                    <% if @last_month_top_products.any? %>
                        <% @last_month_top_products.each_with_index do |product, index| %>
                            <%= render 'shared/product_card', product: product, index: index %>
                        <% end %>
                    <% else %>
                        <div class="empty-section">
                            <p>저번달 출시된 제품이 없습니다.</p>
                        </div>
                    <% end %>
                <% end %>
            </div>
        </div>
    </main>
    
    <aside class="sidebar">
        <div class="sidebar-widget">
            <h3 class="widget-title">인기 태그</h3>
            <div class="tag-list">
                <% @popular_topics.each do |topic| %>
                    <%= link_to topic.name, topic_path(topic), class: "tag" %>
                <% end %>
                
                <% if @popular_topics.empty? %>
                    <a href="#" class="tag">생산성</a>
                    <a href="#" class="tag">인공지능</a>
                    <a href="#" class="tag">개발</a>
                    <a href="#" class="tag">디자인</a>
                    <a href="#" class="tag">건강</a>
                    <a href="#" class="tag">교육</a>
                    <a href="#" class="tag">금융</a>
                    <a href="#" class="tag">이커머스</a>
                <% end %>
            </div>
        </div>
        
        <div class="sidebar-widget">
            <h3 class="widget-title">인기 제품</h3>
            <div class="upcoming-list">
                <% if @popular_products.any? %>
                    <% @popular_products.each do |product| %>
                        <%= link_to product_path(product), class: "upcoming-item", style: "text-decoration: none; color: inherit; display: flex; gap: 12px; align-items: start;" do %>
                            <div class="product-image" style="width: 48px; height: 48px; border-radius: 8px; overflow: hidden; flex-shrink: 0;">
                                <% if product.logo_image.attached? %>
                                    <%= image_tag product.logo_thumb_1x, alt: product.name, style: "width: 100%; height: 100%; object-fit: cover;" %>
                                <% else %>
                                    <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                                        <%= product.name[0].upcase %>
                                    </div>
                                <% end %>
                            </div>
                            <div class="upcoming-item-content" style="flex: 1;">
                                <h4 class="upcoming-item-title"><%= product.name %></h4>
                                <div class="upcoming-item-meta">
                                    <% if product.topics.any? %>
                                        <%= product.topics.first.name %> ·
                                    <% end %>
                                    <%= product.votes_count || 0 %> 투표
                                </div>
                            </div>
                        <% end %>
                    <% end %>
                <% else %>
                    <div style="text-align: center; color: #6b7280; padding: 20px;">
                        아직 등록된 제품이 없습니다
                    </div>
                <% end %>
            </div>
        </div>
        
        <div class="sidebar-widget">
            <h3 class="widget-title">ProductRank 만들기</h3>
            <p style="font-size: 14px; margin-bottom: 15px;">ProductRank는 매일 최고의 새 제품을 공유하는 제품 애호가 커뮤니티입니다.</p>
            <%= link_to "등록하기", new_product_path, class: "signup-btn", style: "display: inline-block; text-align: center;" %>
        </div>
    </aside>
</div>