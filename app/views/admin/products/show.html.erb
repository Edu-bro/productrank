<% content_for :page_title, @product.name %>
<% content_for :page_description, "제품 상세 정보" %>

<div class="admin-container">
    <!-- 헤더 액션 -->
    <div style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;">
        <%= link_to admin_products_path, class: "btn btn-secondary" do %>
            <i class="fas fa-arrow-left"></i> 제품 목록으로
        <% end %>

        <div class="action-buttons">
            <%= link_to edit_admin_product_path(@product), class: "btn btn-primary" do %>
                <i class="fas fa-edit"></i> 수정
            <% end %>
            <%= button_to toggle_featured_admin_product_path(@product), method: :post, class: "btn #{@product.featured? ? 'btn-warning' : 'btn-secondary'}" do %>
                <i class="fas fa-star"></i> <%= @product.featured? ? 'Featured 해제' : 'Featured 설정' %>
            <% end %>
            <%= button_to admin_product_path(@product), method: :delete, form: { data: { turbo_confirm: "정말 삭제하시겠습니까?" } }, class: "btn btn-danger" do %>
                <i class="fas fa-trash"></i> 삭제
            <% end %>
        </div>
    </div>

    <!-- 2단 레이아웃 -->
    <div class="two-column-grid">
        <!-- 메인 컬럼 -->
        <div style="display: flex; flex-direction: column; gap: 24px;">
            <!-- 기본 정보 -->
            <div class="admin-section">
                <div style="display: flex; gap: 16px; margin-bottom: 20px;">
                    <% if @product.logo_url.present? %>
                        <img src="<%= @product.logo_url %>" alt="<%= @product.name %>" style="width: 80px; height: 80px; border-radius: 10px; object-fit: cover;">
                    <% else %>
                        <div style="width: 80px; height: 80px; background: #f5f5f5; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-image" style="color: #ccc; font-size: 32px;"></i>
                        </div>
                    <% end %>

                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <h1 style="font-size: 24px; font-weight: 600; margin: 0;"><%= @product.name %></h1>
                            <span class="status-badge <%= @product.status %>">
                                <%= @product.status.titleize %>
                            </span>
                            <% if @product.featured? %>
                                <span class="topic-tag" style="background: #f3e5f5; color: #9c27b0;">
                                    <i class="fas fa-star"></i> Featured
                                </span>
                            <% end %>
                        </div>
                        <p style="font-size: 16px; color: #666; margin-bottom: 12px;"><%= @product.tagline %></p>
                        <div style="display: flex; gap: 16px; font-size: 14px; color: #666;">
                            <span><i class="fas fa-arrow-up" style="color: #ff6b35;"></i> <%= @product.votes_count %> 투표</span>
                            <span><i class="fas fa-heart" style="color: #e91e63;"></i> <%= @product.likes_count %> 좋아요</span>
                            <span><i class="fas fa-comment" style="color: #2196f3;"></i> <%= @product.comments_count %> 댓글</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                        <h3 style="font-size: 14px; font-weight: 600; color: #666; margin-bottom: 8px;">설명</h3>
                        <p style="color: #333; line-height: 1.6;"><%= @product.description %></p>
                    </div>

                    <% if @product.website_url.present? %>
                        <div>
                            <h3 style="font-size: 14px; font-weight: 600; color: #666; margin-bottom: 8px;">웹사이트</h3>
                            <%= link_to @product.website_url, @product.website_url, target: "_blank", style: "color: #6e8efb; text-decoration: none;" %>
                        </div>
                    <% end %>

                    <div>
                        <h3 style="font-size: 14px; font-weight: 600; color: #666; margin-bottom: 8px;">토픽</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <% @product.topics.each do |topic| %>
                                <span class="topic-tag">
                                    <%= topic.emoji %> <%= topic.name %>
                                </span>
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 출시 정보 -->
            <% if @launch %>
                <div class="admin-section">
                    <h3 class="admin-section-title" style="margin-bottom: 16px;">출시 정보</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div>
                            <p style="font-size: 13px; color: #666; margin-bottom: 4px;">출시일</p>
                            <p style="font-size: 15px; font-weight: 500; color: #333;">
                                <%= @launch.launch_date.strftime('%Y년 %m월 %d일') %>
                            </p>
                        </div>
                        <div>
                            <p style="font-size: 13px; color: #666; margin-bottom: 4px;">지역</p>
                            <p style="font-size: 15px; font-weight: 500; color: #333;"><%= @launch.region || '전세계' %></p>
                        </div>
                        <div>
                            <p style="font-size: 13px; color: #666; margin-bottom: 4px;">상태</p>
                            <span class="status-badge <%= @launch.status %>">
                                <%= @launch.status.titleize %>
                            </span>
                        </div>
                    </div>
                </div>
            <% end %>

            <!-- 최근 댓글 -->
            <div class="admin-section">
                <h3 class="admin-section-title" style="margin-bottom: 16px;">최근 댓글 (<%= @product.comments_count %>)</h3>
                <% if @comments.any? %>
                    <div style="display: flex; flex-direction: column; gap: 16px;">
                        <% @comments.each do |comment| %>
                            <div style="border-bottom: 1px solid #f5f5f5; padding-bottom: 16px; last-child: border-bottom: none;">
                                <div style="display: flex; gap: 12px;">
                                    <span class="user-avatar" style="width: 36px; height: 36px; flex-shrink: 0;">
                                        <%= comment.user.name.first.upcase %>
                                    </span>
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                            <span style="font-size: 14px; font-weight: 500; color: #333;"><%= comment.user.name %></span>
                                            <span style="font-size: 12px; color: #999;"><%= time_ago_in_words(comment.created_at) %> 전</span>
                                        </div>
                                        <p style="font-size: 14px; color: #666; margin: 0;"><%= comment.body %></p>
                                    </div>
                                </div>
                            </div>
                        <% end %>
                    </div>
                <% else %>
                    <p style="text-align: center; color: #999; padding: 32px 0;">아직 댓글이 없습니다.</p>
                <% end %>
            </div>
        </div>

        <!-- 사이드바 -->
        <div style="display: flex; flex-direction: column; gap: 24px;">
            <!-- 등록자 정보 -->
            <div class="admin-section">
                <h3 style="font-size: 14px; font-weight: 600; color: #666; margin-bottom: 16px;">등록자 정보</h3>
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <span class="user-avatar" style="width: 48px; height: 48px; font-size: 18px;">
                        <%= @product.user.name.first.upcase %>
                    </span>
                    <div>
                        <p style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 2px;"><%= @product.user.name %></p>
                        <p style="font-size: 12px; color: #999; margin: 0;"><%= @product.user.email %></p>
                    </div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 8px; font-size: 13px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">역할:</span>
                        <span style="font-weight: 500; color: #333;"><%= @product.user.role.titleize %></span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">등록 제품:</span>
                        <span style="font-weight: 500; color: #333;"><%= @product.user.products.count %>개</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #666;">평판:</span>
                        <span style="font-weight: 500; color: #333;"><%= @product.user.reputation %></span>
                    </div>
                </div>
            </div>

            <!-- 메타 정보 -->
            <div class="admin-section">
                <h3 style="font-size: 14px; font-weight: 600; color: #666; margin-bottom: 16px;">메타 정보</h3>
                <div style="display: flex; flex-direction: column; gap: 12px; font-size: 13px;">
                    <div>
                        <p style="color: #666; margin-bottom: 4px;">등록일</p>
                        <p style="font-weight: 500; color: #333; margin: 0;"><%= @product.created_at.strftime('%Y년 %m월 %d일 %H:%M') %></p>
                    </div>
                    <div>
                        <p style="color: #666; margin-bottom: 4px;">최종 수정</p>
                        <p style="font-weight: 500; color: #333; margin: 0;"><%= @product.updated_at.strftime('%Y년 %m월 %d일 %H:%M') %></p>
                    </div>
                    <div>
                        <p style="color: #666; margin-bottom: 4px;">제품 ID</p>
                        <p style="font-family: monospace; font-size: 11px; color: #333; margin: 0;"><%= @product.id %></p>
                    </div>
                </div>
            </div>

            <!-- 빠른 액션 -->
            <% if @product.draft? %>
                <div class="stat-card" style="background: #fff3e0; border: 1px solid #ffb74d;">
                    <h3 style="font-size: 14px; font-weight: 600; color: #f57c00; margin-bottom: 16px;">초안 상태</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <%= button_to "출시하기", approve_admin_product_path(@product), method: :post, form: { data: { turbo_confirm: "이 제품을 출시하시겠습니까?" } }, class: "btn btn-success", style: "width: 100%; justify-content: center;" %>
                        <%= button_to "거부하기", reject_admin_product_path(@product), method: :post, form: { data: { turbo_confirm: "이 제품을 거부하시겠습니까?" } }, class: "btn btn-danger", style: "width: 100%; justify-content: center;" %>
                    </div>
                </div>
            <% end %>
        </div>
    </div>
</div>
