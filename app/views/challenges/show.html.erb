<div class="challenge-container" style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">

  <!-- 헤더 설명 -->
  <div style="margin-bottom: 2rem;">
    <h1 style="font-size: 2rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">
      <%= @period_title %>
    </h1>
    <p style="font-size: 1.125rem; color: #6b7280;">
      이번 <%= @period_type == 'weekly' ? '주' : '달' %> 신규 런칭 제품들이 실시간 경쟁 중입니다. 지금 투표해서 1위를 결정하세요.
    </p>
  </div>

  <!-- 필터 영역 -->
  <div style="background: #f9fafb; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 2rem; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);">
    <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; justify-content: space-between;">

      <!-- 왼쪽: 기간 토글 & 카테고리 -->
      <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center;">
        <!-- 기간 토글 -->
        <div style="display: flex; background: #e5e7eb; border-radius: 9999px; padding: 2px;">
          <%= link_to challenges_weekly_path(category: params[:category], sort: params[:sort]),
              style: "flex: 1; padding: 0.5rem 1rem; border-radius: 9999px; text-align: center; font-size: 0.875rem; font-weight: 600; transition: all 0.2s; text-decoration: none; #{@period_type == 'weekly' ? 'background: white; color: #1f2937; box-shadow: 0 1px 3px rgba(0,0,0,0.1);' : 'color: #6b7280;'}" do %>
            주간
          <% end %>
          <%= link_to challenges_monthly_path(category: params[:category], sort: params[:sort]),
              style: "flex: 1; padding: 0.5rem 1rem; border-radius: 9999px; text-align: center; font-size: 0.875rem; font-weight: 600; transition: all 0.2s; text-decoration: none; #{@period_type == 'monthly' ? 'background: white; color: #1f2937; box-shadow: 0 1px 3px rgba(0,0,0,0.1);' : 'color: #6b7280;'}" do %>
            월간
          <% end %>
        </div>

        <!-- 카테고리 필터 -->
        <div style="position: relative;">
          <%= form_with url: (@period_type == 'weekly' ? challenges_weekly_path : challenges_monthly_path), method: :get, local: true, style: "margin: 0;" do |f| %>
            <%= f.hidden_field :sort, value: params[:sort] %>
            <%= f.select :category,
                options_for_select([['카테고리: 전체', '전체']] + Topic.all.map { |t| [t.name, t.slug] }, params[:category] || '전체'),
                {},
                {
                  onchange: "this.form.submit()",
                  style: "appearance: none; width: 100%; border-radius: 0.375rem; border: 1px solid #d1d5db; background: white; padding: 0.5rem 2.5rem 0.5rem 0.75rem; font-size: 0.875rem; font-weight: 500; color: #374151; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.05); background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%23374151%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1rem;"
                } %>
          <% end %>
        </div>
      </div>

      <!-- 오른쪽: 정렬 & 상태 -->
      <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center;">
        <!-- 정렬 필터 -->
        <div style="position: relative;">
          <%= form_with url: (@period_type == 'weekly' ? challenges_weekly_path : challenges_monthly_path), method: :get, local: true, style: "margin: 0;" do |f| %>
            <%= f.hidden_field :category, value: params[:category] %>
            <%= f.select :sort,
                options_for_select(['투표순', '최신순', '댓글순'], params[:sort] || '투표순'),
                {},
                {
                  onchange: "this.form.submit()",
                  style: "appearance: none; border-radius: 0.375rem; border: 1px solid #d1d5db; background: white; padding: 0.5rem 2.5rem 0.5rem 0.75rem; font-size: 0.875rem; cursor: pointer; background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2724%27 height=%2724%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27%23374151%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1rem;"
                } %>
          <% end %>
        </div>

        <!-- 챌린지 상태 -->
        <% if @challenge %>
          <div style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #059669; background: #d1fae5; padding: 0.5rem 1rem; border-radius: 9999px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); font-size: 0.875rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#059669" stroke="#059669" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
            <span><%= @challenge.status_text %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- 제품 목록 -->
  <div style="display: grid; gap: 1rem;">
    <% if @products && @products.any? %>
      <% @products.each_with_index do |product, index| %>
        <%= render 'shared/product_card', product: product, index: index %>
      <% end %>
    <% else %>
      <div style="text-align: center; padding: 4rem 1rem; background: #f3f4f6; border-radius: 0.75rem;">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 1rem;"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/><path d="M15 3v18"/></svg>
        <h3 style="font-size: 1.25rem; font-weight: 600; color: #6b7280; margin-bottom: 0.5rem;">선택된 필터의 제품이 없습니다</h3>
        <p style="color: #9ca3af;">다른 필터를 선택해보세요.</p>
      </div>
    <% end %>
  </div>

</div>
